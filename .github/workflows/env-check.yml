name: Prevent secrets in PRs

on:
  pull_request:
  push:

jobs:
  env-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check for tracked env files
        run: |
          set -e
          tracked=$(git ls-files -- "*.env" ".env*" || true)
          # allow .env.example
          tracked=$(echo "$tracked" | grep -v "^\.env.example$" || true)
          if [ -n "$tracked" ]; then
            echo "The following env-like files are tracked (remove them before merging):"
            echo "$tracked"
            exit 1
          else
            echo "No tracked env files found."
          fi
